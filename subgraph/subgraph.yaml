specVersion: 0.0.5
schema:
  file: ./schema.graphql
dataSources:
  - kind: ethereum/contract
    name: PoolFactory
    network: core
    source:
      address: "0xe51bf3555bb2d2be89ca58b994f0826f040c6f8a"
      abi: PoolFactory
      startBlock: 7259922
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/poolFactory.ts
      entities:
        - PoolFactory
        - Pool
        - User
      abis:
        - name: PoolFactory
          file: ../smart-contracts/artifacts/contracts/PoolFactory.sol/PoolFactory.json
        - name: Pool
          file: ../smart-contracts/artifacts/contracts/Pool.sol/Pool.json
      eventHandlers:
        - event: CreatedPool(indexed address,string,string,string,(string),(string),address,address,uint256,uint256,uint256)
          handler: handlePoolCreated

  - kind: ethereum/contract
    name: Marketplace
    network: core
    source:
      address: "0xb4b9156de6dcd0d3cfdcb4f6d17ac513e2109fd3"
      abi: Marketplace
      startBlock: 7259922
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/marketplace.ts
      entities:
        - MarketListing
        - User
        - Share
        - SharesContract
      abis:
        - name: Marketplace
          file: ../smart-contracts/artifacts/contracts/Marketplace.sol/Marketplace.json
      eventHandlers:
        - event: Listed(indexed uint256,indexed address,address,address,uint256,uint256,address,uint256)
          handler: handleListed
        - event: Purchased(indexed uint256,indexed address)
          handler: handlePurchased
        - event: Delisted(indexed uint256)
          handler: handleDelisted

  - kind: ethereum/contract
    name: BorrowCredit
    network: core
    source:
      address: "0x9a2f9b67e31f90dcf2b1bf8458220da1b4568c5b"
      abi: BorrowCredit
      startBlock: 7259922
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/borrowCredit.ts
      entities:
        - CreditInfo
        - User
        - Transaction
      abis:
        - name: BorrowCredit
          file: ../smart-contracts/artifacts/contracts/core/BorrowCredit.sol/BorrowCredit.json
      eventHandlers:
        - event: CreateCredits(address,(string),uint256,address[])
          handler: handleCreditCreated
        - event: CreditSpent(address,address,uint256)
          handler: handleCreditSpent
        - event: CreditReplenished(address,address,uint256)
          handler: handleCreditReplenished
        - event: IncrementedCredits(address,uint256)
          handler: handleIncrementedCredits
        - event: DecrementedCredits(address,uint256)
          handler: handleDecrementedCredits
        - event: AddedAccessiblePool(address,address)
          handler: handleAddedAccessiblePool
        - event: RemovedAccessiblePool(address,address)
          handler: handleRemovedAccessiblePool

  - kind: ethereum/contract
    name: Oracle
    network: core
    source:
      address: "0x1d989d28d206a777a055a4017a6be2296649fffd"
      abi: Oracle
      startBlock: 7259922
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/oracle.ts
      entities:
        - CreditFeed
      abis:
        - name: Oracle
          file: ../smart-contracts/artifacts/contracts/core/Oracle.sol/Oracle.json
      eventHandlers:
        - event: CreditToAssetSet(address,uint256)
          handler: handleCreditToAssetSet

templates:
  - name: Pool
    kind: ethereum/contract
    network: core
    source:
      abi: Pool
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/pool.ts
      entities:
        - Pool
        - User
        - Share
        - Position
        - Transaction
        - PoolSnapshot
        - SharesContract
        - PositionContract
      abis:
        - name: Pool
          file: ../smart-contracts/artifacts/contracts/Pool.sol/Pool.json
        - name: Shares
          file: ../smart-contracts/artifacts/contracts/core/Shares.sol/Shares.json
        - name: Position
          file: ../smart-contracts/artifacts/contracts/core/Position.sol/Position.json
      eventHandlers:
        - event: InitializedPool(address,address)
          handler: handlePoolInitialized
        - event: DepositedPool(indexed address,uint256,uint256,uint256)
          handler: handleDeposited
        - event: BorrowedPool(indexed address,uint256,uint256,uint256)
          handler: handleBorrowed
        - event: RepaidPool(indexed address,uint256,uint256,uint256)
          handler: handleRepaid
        - event: RequestedWithdrawPool(indexed address,uint256,uint256)
          handler: handleWithdrawRequested
        - event: ClaimedWithdrawPool(indexed address,uint256,uint256)
          handler: handleWithdrawClaimed
        - event: SetBorrowApy(uint256)
          handler: handleSetBorrowApy
        - event: SetWithdrawDelay(uint256)
          handler: handleSetWithdrawDelay
        - event: SetLockPeriod(uint256)
          handler: handleSetLockPeriod
        - event: Paused(address)
          handler: handlePaused
        - event: Unpaused(address)
          handler: handleUnpaused

  - name: Shares
    kind: ethereum/contract
    network: core
    source:
      abi: Shares
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/shares.ts
      entities:
        - Share
        - User
      abis:
        - name: Shares
          file: ../smart-contracts/artifacts/contracts/core/Shares.sol/Shares.json
      eventHandlers:
        - event: AddedShares(address,uint256,uint256,uint256)
          handler: handleAddedShares
        - event: RemovedShares(address,uint256,uint256)
          handler: handleRemovedShares
        - event: ClosedShares(address,uint256)
          handler: handleClosedShares
        - event: ClaimedShares(uint256)
          handler: handleClaimedShares
        - event: RevertShares(uint256,uint256)
          handler: handleRevertedShares

  - name: Position
    kind: ethereum/contract
    network: core
    source:
      abi: Position
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/position.ts
      entities:
        - Position
        - User
      abis:
        - name: Position
          file: ../smart-contracts/artifacts/contracts/core/Position.sol/Position.json
      eventHandlers:
        - event: IncrementPosition(indexed address,address,uint256,uint256,uint256)
          handler: handlePositionIncremented
        - event: DecrementPosition(indexed address,uint256,uint256)
          handler: handlePositionDecremented
